<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <style>
    button {
      margin-top: 40px;
    }
  </style>
</head>

<body>
  <div>
    <user-card id="userCard" image="/fluctuation.jpg" name="fluctuation" email="invset@gmail.com">
      <span slot="address">深圳福田</span>
    </user-card>
    <button onclick="getCompnent()">我是一个按钮</button>
    <button onclick="changeName()">修改名称</button>
    <button onclick="changeEmail()">修改邮箱</button>
  </div>
  <template id="userCardTemplate">
    <style>
      :host {
        display: flex;
        align-items: center;
        width: 450px;
        height: 180px;
        background-color: #d4d4d4;
        border: 1px solid #d5d5d5;
        box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.1);
        border-radius: 3px;
        overflow: hidden;
        padding: 10px;
        font-family: 'Poppins', sans-serif;
      }

      .image {
        flex: 0 0 auto;
        width: 177px;
        height: 155px;
        vertical-align: middle;
        border-radius: 5px;
      }

      .container {
        padding: 20px;
        height: 160px;
      }

      .container>.name {
        font-size: 20px;
        font-weight: 600;
        line-height: 1;
        margin: 0;
        margin-bottom: 5px;
      }

      .container>.email {
        font-size: 12px;
        opacity: 0.75;
        line-height: 1;
        margin: 0;
        margin-bottom: 15px;
      }

      .container>.button {
        padding: 10px 25px;
        font-size: 12px;
        border-radius: 5px;
        text-transform: uppercase;
      }
    </style>
    <img class="image" />
    <div class="container">
      <p class="name"></p>
      <p class="email"></p>
      <p>
        <slot name="address">深圳龙岗</slot>
      </p>
      <button class="button">Follow</button>
    </div>
  </template>
  <script>
    class UserCard extends HTMLElement {
      constructor() {
        super()
        let template = document.getElementById('userCardTemplate')
        let content = template.content.cloneNode(true) // 克隆一份，因为组件可能会被多处引用
        content.querySelector('img').src = this.getAttribute('image')
        content.querySelector('.email').innerText = this.getAttribute('email')

        let button = content.querySelector('button')
        button.onclick = () => console.log('follow')


        // this.appendChild(content)

        let shadow = this.attachShadow({ mode: 'open' }) // open 外部可访问，closed 外部不可访问
        shadow.appendChild(content)

        // var image = document.createElement('img');
        // image.src = 'https://semantic-ui.com/images/avatar2/large/kristy.png';
        // image.classList.add('image');

        // var container = document.createElement('div');
        // container.classList.add('container');

        // var name = document.createElement('p');
        // name.classList.add('name');
        // name.innerText = 'User Name';

        // var email = document.createElement('p');
        // email.classList.add('email');
        // email.innerText = 'yourmail@some-email.com';

        // var button = document.createElement('button');
        // button.classList.add('button');
        // button.innerText = 'Follow';
        // button.onclick = () => {
        //   console.log('follow');
        // }

        // container.append(name, email, button);
        // this.append(image, container);
      }

      // 需要监听的属性, 两种写法都可以
      static observedAttributes = ['name']
      // static get observedAttributes() {
      //   return ['name']
      // }

      // 属性变化时的回调，固定方法名（如果有值，初始就会执行一次）
      attributeChangedCallback(name, oldValue, newValue) {
        if (name === 'name') {
          const nameEl = this.shadowRoot.querySelector('.name')
          nameEl.textContent = newValue
        }
      }

      // 直接通过 对象.xxx 的方式修改值
      set email(newValue) {
        const emailEl = this.shadowRoot.querySelector('.email')
        emailEl.textContent = newValue
      }
    }
    customElements.define('user-card', UserCard)

    // 按钮事件
    function getCompnent() {
      let userCard = document.querySelector('user-card')
      console.log(userCard)
      console.log(userCard.shadowRoot) // mode 为 closed 时，打印结果为 null
    }

    function changeName() {
      const userCard = document.querySelector('#userCard')
      userCard.setAttribute('name', 'oscillation')
    }

    function changeEmail() {
      const userCard = document.querySelector('#userCard')
      userCard.email = 'web@qq.com'
    }
  </script>
</body>

</html>